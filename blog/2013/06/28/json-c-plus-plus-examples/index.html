
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Json C++ Examples - Thomas Whitton</title>
	<meta name="author" content="Thomas Whitton">

	
	<meta name="description" content="In each of the examples below I have tried to show you most of the different aspects of using json, i.e. creating json messages from scratch, &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Thomas Whitton" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Thomas Whitton</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://https://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.thomaswhitton.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/112919431559357572505?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/thomaswhitton" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/oracal" title="GitHub">GitHub</a>
		
    
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/thomaswhitton">LinkedIn</a>
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://https://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:www.thomaswhitton.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Json C++ Examples</h2>
	<div class="entry-content"><p>In each of the examples below I have tried to show you most of the different aspects of using json, i.e. creating json messages from scratch, outputting json, parsing json and querying json objects. The example json message used contains most of the features that a json message could contain. Querying the json object has been extracted into an output function which is used multiple times in each example to show that everything is working correctly.</p>

<!-- more -->


<h3>jsoncpp</h3>

<ul>
<li>mature</li>
<li>feature complete</li>
<li>c++ interface</li>
<li>very simple api</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">// ---- create from scratch ----</span>
</span><span class='line'>
</span><span class='line'><span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">fromScratch</span><span class="p">;</span>
</span><span class='line'><span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">array</span><span class="p">;</span>
</span><span class='line'><span class="n">array</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">array</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">[</span><span class="s">&quot;hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;world&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">[</span><span class="s">&quot;number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">;</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">[</span><span class="s">&quot;object&quot;</span><span class="p">][</span><span class="s">&quot;hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;world&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">output</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// write in a nice readible way</span>
</span><span class='line'><span class="n">Json</span><span class="o">::</span><span class="n">StyledWriter</span> <span class="n">styledWriter</span><span class="p">;</span>
</span><span class='line'><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">styledWriter</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ---- parse from string ----</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// write in a compact way</span>
</span><span class='line'><span class="n">Json</span><span class="o">::</span><span class="n">FastWriter</span> <span class="n">fastWriter</span><span class="p">;</span>
</span><span class='line'><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">jsonMessage</span> <span class="o">=</span> <span class="n">fastWriter</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">parsedFromString</span><span class="p">;</span>
</span><span class='line'><span class="n">Json</span><span class="o">::</span><span class="n">Reader</span> <span class="n">reader</span><span class="p">;</span>
</span><span class='line'><span class="kt">bool</span> <span class="n">parsingSuccessful</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">jsonMessage</span><span class="p">,</span> <span class="n">parsedFromString</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">parsingSuccessful</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">styledWriter</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">parsedFromString</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="k">const</span> <span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// querying the json object is very simple</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">[</span><span class="s">&quot;hello&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">[</span><span class="s">&quot;number&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">[</span><span class="s">&quot;object&quot;</span><span class="p">][</span><span class="s">&quot;hello&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>rapidjson</h3>

<ul>
<li>header only</li>
<li>very fast</li>
<li>c++ interface</li>
<li>verbose api</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">// ---- create from scratch ----</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// document is the root of a json message</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span> <span class="n">fromScratch</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// define the document as an object rather than an array</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">.</span><span class="n">SetObject</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// create a rapidjson array type with similar syntax to std::vector</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">Value</span> <span class="n">array</span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">kArrayType</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// must pass an allocator when the object may need to allocate memory</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span><span class="o">::</span><span class="n">AllocatorType</span><span class="o">&amp;</span> <span class="n">allocator</span> <span class="o">=</span> <span class="n">fromScratch</span><span class="p">.</span><span class="n">GetAllocator</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// chain methods as rapidjson provides a fluent interface when modifying its objects</span>
</span><span class='line'><span class="n">array</span><span class="p">.</span><span class="n">PushBack</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">).</span><span class="n">PushBack</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">fromScratch</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;array&quot;</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// create a rapidjson object type</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">Value</span> <span class="n">object</span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">kObjectType</span><span class="p">);</span>
</span><span class='line'><span class="n">object</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="n">object</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">[</span><span class="s">&quot;object&quot;</span><span class="p">][</span><span class="s">&quot;hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;world&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">output</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ---- parse from string ----</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Convert JSON document to string</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">StringBuffer</span> <span class="n">strbuf</span><span class="p">;</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">Writer</span><span class="o">&lt;</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">StringBuffer</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">(</span><span class="n">strbuf</span><span class="p">);</span>
</span><span class='line'><span class="n">fromScratch</span><span class="p">.</span><span class="n">Accept</span><span class="p">(</span><span class="n">writer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// parse json string</span>
</span><span class='line'><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span> <span class="n">parsedFromString</span><span class="p">;</span>
</span><span class='line'><span class="n">parsedFromString</span><span class="p">.</span><span class="n">Parse</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">strbuf</span><span class="p">.</span><span class="n">GetString</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'><span class="n">output</span><span class="p">(</span><span class="n">parsedFromString</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="k">const</span> <span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span> <span class="o">&amp;</span> <span class="n">document</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// treat object types similar to std::map when querying</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">document</span><span class="p">[</span><span class="s">&quot;hello&quot;</span><span class="p">].</span><span class="n">GetString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">document</span><span class="p">[</span><span class="s">&quot;number&quot;</span><span class="p">].</span><span class="n">GetInt</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// requires SizeType since the literal zero in c++ can mean a</span>
</span><span class='line'>    <span class="c1">// numeric type (int, unsigned, etc.) or a null pointer of any type</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">document</span><span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">][</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">SizeType</span><span class="p">(</span><span class="mi">0</span><span class="p">)].</span><span class="n">GetString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">document</span><span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">].</span><span class="n">GetString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">document</span><span class="p">[</span><span class="s">&quot;object&quot;</span><span class="p">][</span><span class="s">&quot;hello&quot;</span><span class="p">].</span><span class="n">GetString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>jansson</h3>

<ul>
<li>mature</li>
<li>simple c interface</li>
<li>nasty memory allocation mainly due to it being a c library</li>
<li>every json item is a json_t pointer, which must be checked to see what type it is before being used</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">// ---- create from scratch ----</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// create json &quot;objects&quot; and use the json_t pointer to point to them</span>
</span><span class='line'><span class="n">json_t</span> <span class="o">*</span><span class="n">fromScratch</span> <span class="o">=</span> <span class="n">json_object</span><span class="p">();</span>
</span><span class='line'><span class="n">json_t</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="n">json_array</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use the new version of the method to aboud have to call json_decref on each json object</span>
</span><span class='line'><span class="c1">// must encompass values in their respective methods</span>
</span><span class='line'><span class="n">json_array_append_new</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">json_string</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">));</span>
</span><span class='line'><span class="n">json_array_append_new</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">json_string</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">json_object_set_new</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">,</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">json_string</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">));</span>
</span><span class='line'><span class="n">json_object_set_new</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">,</span> <span class="s">&quot;number&quot;</span><span class="p">,</span> <span class="n">json_integer</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'><span class="n">json_object_set_new</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">,</span> <span class="s">&quot;array&quot;</span><span class="p">,</span> <span class="n">array</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// json pack provies an easy to use api to create json structures using a</span>
</span><span class='line'><span class="c1">// special string syntax as the first argument</span>
</span><span class='line'><span class="n">json_object_set_new</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">,</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;{ss}&quot;</span><span class="p">,</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">output</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ---- parse from string ----</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use json_dumps to output raw json from the json &quot;objects&quot;</span>
</span><span class='line'><span class="kt">char</span> <span class="o">*</span> <span class="n">jsonOutput</span> <span class="o">=</span> <span class="n">json_dumps</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// can use special flags to make the json more human readible</span>
</span><span class='line'><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">json_dumps</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">,</span> <span class="n">JSON_INDENT</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">json_error_t</span> <span class="n">error</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// parse the json and</span>
</span><span class='line'><span class="n">json_t</span> <span class="o">*</span><span class="n">parsedFromString</span> <span class="o">=</span> <span class="n">json_loads</span><span class="p">(</span><span class="n">jsonOutput</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// memory management for the json &quot;objects&quot;</span>
</span><span class='line'><span class="n">free</span><span class="p">(</span><span class="n">jsonOutput</span><span class="p">);</span>
</span><span class='line'><span class="n">json_decref</span><span class="p">(</span><span class="n">fromScratch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">parsedFromString</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">output</span><span class="p">(</span><span class="n">parsedFromString</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">error</span><span class="p">.</span><span class="n">text</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">json_decref</span><span class="p">(</span><span class="n">parsedFromString</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="k">const</span> <span class="n">json_t</span><span class="o">*</span> <span class="n">document</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// lots of checking to see if json_t is of the right type</span>
</span><span class='line'>    <span class="c1">// since it is just a json_t pointer</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">json_is_object</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">json_t</span><span class="o">*</span> <span class="n">string</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="s">&quot;hello&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">json_is_string</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">json_string_value</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">json_t</span><span class="o">*</span> <span class="n">number</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="s">&quot;number&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">json_is_integer</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">json_integer_value</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">json_t</span><span class="o">*</span> <span class="n">array</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="s">&quot;array&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">json_is_array</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">json_t</span><span class="o">*</span> <span class="n">index</span><span class="p">;</span>
</span><span class='line'>            <span class="n">index</span> <span class="o">=</span> <span class="n">json_array_get</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="n">json_is_string</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">json_string_value</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">index</span> <span class="o">=</span> <span class="n">json_array_get</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="n">json_is_string</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">json_string_value</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">json_t</span><span class="o">*</span> <span class="n">object</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="s">&quot;object&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">json_is_object</span><span class="p">(</span><span class="n">object</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">json_t</span><span class="o">*</span> <span class="n">objectString</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="s">&quot;hello&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="n">json_is_string</span><span class="p">(</span><span class="n">objectString</span><span class="p">))</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">json_string_value</span><span class="p">(</span><span class="n">objectString</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conslusion</h2>

<p>I think the choice is very much dependent on what your use case is. If you would like a very simple api and do not rely too heavily on being super fast then the obvious choice is jsoncpp, especially if there is a package available on your distribution that you can link against. If you require super fast json encoding and decoding or are working on a system where a header-only library is an attractive option then choose rapidjson. Since we&rsquo;re talking about c++ here, I don&rsquo;t think there should be a situation in which you should choose jansson over the others.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-28T19:54:00+01:00" pubdate data-updated="true">Jun 28<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/json/'>json</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
		
		
		<a class="addthis_button_tweet"></a>
		
		
		<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Thomas Whitton

</footer>
	<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'thomaswhitton';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.thomaswhitton.com/blog/2013/06/28/json-c-plus-plus-examples/';
        var disqus_url = 'http://www.thomaswhitton.com/blog/2013/06/28/json-c-plus-plus-examples/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>